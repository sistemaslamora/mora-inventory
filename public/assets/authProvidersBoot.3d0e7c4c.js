import{f as U,r as c,c as R,w as P,u as C,i as y,j as S,e as x,A as $}from"./index.f090f687.js";import{c as _}from"./index.ea930b6c.js";var J={credentials:{supabaseUrl:"https://xyclixgnixwkizbakynf.supabase.co",supabaseKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh5Y2xpeGduaXh3a2l6YmFreW5mIiwicm9sZSI6ImFub24iLCJpYXQiOjE2NTc4NDQ3OTksImV4cCI6MTk3MzQyMDc5OX0.8ieHTUbV8kvQSY7xWjMg0jvQulkq6iq-nhx5qpLdcfg"}};const T=Symbol("SupabaseDefaultClient");function q(e){let r=!1,t;const a=U(!0);return()=>(r||(t=a.run(e),r=!0),t)}const O=q(()=>{const e=c(null),r=R(()=>!!e.value);return{authIsReady:c(!0),isAuthenticated:r,user:e}}),z={install:(e,r)=>{if(!r||!r.credentials||!r.credentials.supabaseKey||!r.credentials.supabaseUrl)throw Error("Credentials must be provided when installing supabase");const{supabaseUrl:t,supabaseKey:a}=r.credentials,n=_(t,a),{user:s,authIsReady:u}=O();n.auth.onAuthStateChange((d,l)=>{var f;u.value=!0,s.value=(f=l==null?void 0:l.user)!=null?f:null}),e.provide(T,n)}},v=()=>{const e=y(T);if(!e)throw Error("Error injecting supabase client");return e},D=Symbol.for("auth:defaultProvider"),k=()=>{const e=y(D);if(e)return S(e);throw new Error("default auth provider key not found")},M=(e="",r="")=>{r=r||k();let t;return e?(t=y(Symbol.for(`auth:${r}.${e}.config`)),t!=null?t:{}):(t=y(Symbol.for(`auth:${r}.config`)),t!=null?t:{})},K=(e,r,...t)=>{var u;r.authProvider=(u=r.authProvider)!=null?u:k();const a=M(e,r.authProvider),n=Symbol.for(`auth:${r.authProvider}:${e}`),s=y(n);if(s&&typeof s=="function"){let d;return s.baseConfig&&typeof s.baseConfig=="object"?d={...s.baseConfig,...a,...r}:d={...a,...r},s(d,...t)}else throw new Error(`unable to find inject key: ${n.toString()}`)},Q=["authenticated","unauthenticated","error"],X="authRedirector",F=e=>{if(!e.redirectOn||!Q.includes(e.redirectOn))throw new Error("useAuthRedirector config: 'redirectOn' is either missing or invalid");return K(X,e)},Y=()=>{const e=c([]);function r(){e.value=[]}const t=R(()=>!!e.value.length),a=c({}),n=R(()=>!!Object.keys(a.value).length);function s(){a.value={}}const u=R(()=>t.value||n.value);function d(){r(),s()}return{errors:e,hasStandardErrors:t,resetStandardErrors:r,validationErrors:a,hasValidationErrors:n,resetValidationErrors:s,hasErrors:u,resetErrors:d}},w=()=>{const e=Y(),{resetErrors:r,errors:t}=e;function a(n){r(),t.value.push({type:`CODE: ${n.status}`,message:n.message})}return{...e,fromResponse:a}},H=()=>{const e=c(!1),r=v(),{hasErrors:t,errors:a,resetStandardErrors:n,resetErrors:s,fromResponse:u}=w();return{logout:async()=>{e.value=!0;const{error:l}=await r.auth.signOut();l&&u(l),e.value=!1},loading:e,hasErrors:t,errors:a,resetStandardErrors:n,resetErrors:s}},A=()=>{const e=v(),r=c(!1),{errors:t,hasErrors:a,fromResponse:n,validationErrors:s,hasValidationErrors:u,resetStandardErrors:d,resetValidationErrors:l,resetErrors:f}=w(),o=c({email:"",password:"",password_confirmation:""});function h(){Object.keys(o.value).forEach(i=>{o.value[i]=""})}return P(o.value,()=>{f()}),{form:o,register:async()=>{if(r.value=!0,o.value.password!==o.value.password_confirmation){t.value.push({type:"validation",message:"The password confirmation does not match."}),r.value=!1;return}const{error:i}=await e.auth.signUp(o.value);i&&n(i),r.value=!1},loading:r,validationErrors:s,hasValidationErrors:u,hasErrors:a,errors:t,resetStandardErrors:d,resetValidationErrors:l,resetErrors:f,resetForm:h}};A.baseConfig={emailConfirm:!1};const L=()=>{const e=c(!1),r=v(),{validationErrors:t,hasValidationErrors:a,hasErrors:n,errors:s,resetErrors:u,fromResponse:d,resetStandardErrors:l,resetValidationErrors:f}=w(),o=c({email:"",password:""});function h(){Object.keys(o.value).forEach(i=>{o.value[i]=""})}return P(o.value,()=>{u()}),{form:o,login:async()=>{e.value=!0;const{error:i}=await r.auth.signIn(o.value);i&&d(i),e.value=!1},loading:e,validationErrors:t,hasValidationErrors:a,hasErrors:n,errors:s,resetErrors:u,resetStandardErrors:l,resetValidationErrors:f,resetForm:h}},G=()=>{const{hasErrors:e,errors:r,resetStandardErrors:t,resetErrors:a}=w(),n=c(!1),s=v();function u(){return new Promise(d=>{const l=s.auth.user();d(l)})}return{loading:n,fetch:u,hasErrors:e,errors:r,resetStandardErrors:t,resetErrors:a}},N=()=>{const e=c(!1),t=v().auth,{errors:a,hasErrors:n,fromResponse:s,validationErrors:u,hasValidationErrors:d,resetStandardErrors:l,resetValidationErrors:f,resetErrors:o}=w(),h=c({email:""});function E(){Object.keys(h.value).forEach(p=>{h.value[p]=""})}const i=c({password:"",password_confirmation:""});function g(){Object.keys(i.value).forEach(p=>{i.value[p]=""})}const m=async()=>{e.value=!0;const{error:p}=await t.api.resetPasswordForEmail(h.value.email,{redirectTo:window.location.origin+"/password-reset"});p&&s(p),e.value=!1},I=async()=>{e.value=!0;const{error:p}=await t.api.updateUser(b(),{password:i.value.password});p&&s(p),e.value=!1};function b(){const p=t.session();if(!p)throw new Error("Missing session data. Ensure the password reset link is correct.");return p.access_token}return{requestForm:h,resetRequestForm:E,resetResetPasswordForm:g,requestReset:m,reset:I,loading:e,resetPasswordForm:i,validationErrors:u,hasValidationErrors:d,hasErrors:n,errors:a,resetStandardErrors:l,resetValidationErrors:f,resetErrors:o}},Z=()=>{const e=c(!1),r=v(),{errors:t,hasErrors:a,fromResponse:n,validationErrors:s,hasValidationErrors:u,resetStandardErrors:d,resetValidationErrors:l,resetErrors:f}=w(),o=c({password:"",password_confirmation:""});function h(){Object.keys(o.value).forEach(i=>{o.value[i]=""})}return{form:o,update:async()=>{if(o.value.password!==o.value.password_confirmation){s.value.password=["password and password confirmation must match"];return}if(typeof o.value.password=="string"&&o.value.password.length<6){s.value.password=["password must be at least 6 characters long"];return}e.value=!0;const{error:i}=await r.auth.update({password:o.value.password});i&&n(i),e.value=!1},loading:e,resetForm:h,validationErrors:s,hasValidationErrors:u,hasErrors:a,errors:t,resetStandardErrors:d,resetValidationErrors:l,resetErrors:f}},V=(e={redirectTo:c("/"),router:C()})=>(e.redirectOn="authenticated",{...F(e)});V.baseConfig={};const B=(e={redirectTo:c("/"),router:C()})=>(e.redirectOn="unauthenticated",{...F(e)}),j=(e={redirectOn:"authenticated",redirectTo:c("/")})=>{var i,g;const r=c(!1),t=v();e.redirectTo=(i=e.redirectTo)!=null?i:c("/"),e.router=(g=e.router)!=null?g:C();const{isAuthenticated:a,user:n,authIsReady:s}=O(),u=c(null);function d(){typeof u.value=="function"&&u.value(n.value),r.value=!1,E()}function l(){return s.value?d():h()}function f(){if(!a.value&&e.redirectOn==="unauthenticated"){if(!e.router)throw new Error("config.router not defined: cannot redirect");if(!e.redirectTo)throw new Error("config.redirectTo not defined: cannot redirect");e.router.push(S(e.redirectTo))}}function o(){if(a.value&&e.redirectOn==="authenticated"){if(!e.router)throw new Error("config.router not defined: cannot redirect");if(!e.redirectTo)throw new Error("config.redirectTo not defined: cannot redirect");e.router.push(S(e.redirectTo))}}function h(){r.value=!0;const{data:m}=t.auth.onAuthStateChange((I,b)=>{s.value=!0,typeof u.value=="function"&&u.value(b==null?void 0:b.user),f(),o(),r.value=!1,m==null||m.unsubscribe()})}function E(){o(),f()}return{execOnAuthStateChange:h,execOnAuthStateEnsured:l,exec:d,redirectTo:e.redirectTo,checking:r,onChecked:u}};j.baseConfig={};var re=x(({app:e})=>{e.use(z,J),e.use($,{default:"supabase",providers:{supabase:{features:{"identityPassword:register":A,"identityPassword:login":L,"identityPassword:logout":H,unauthenticatedRedirector:B,authenticatedRedirector:V,errorHandler:w,fetchUser:G,authState:O,authRedirector:j,passwordResetViaEmail:N,updatePassword:Z}}}})});export{re as default};
